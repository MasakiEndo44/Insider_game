# Phase 5: E2Eテストシナリオ

**作成日**: 2025-11-23
**目的**: 実際のマルチプレイ環境（複数ブラウザ/デバイス）でのゲームフロー検証と、既知の課題（投票遷移の不安定性など）の確認。

## 🧪 テスト環境
- **必須**: 3つ以上の異なるブラウザセッション（Chrome, Firefox, Safari, シークレットウィンドウ等）
- **推奨**: PCとモバイル端末の混在環境

## 📝 シナリオ 1: 基本フロー（3人プレイ）

正常系動作の確認。特にフェーズ遷移とRealtime同期に注目する。

### 準備
1. ブラウザA（ホスト）: `Player A`
2. ブラウザB: `Player B`
3. ブラウザC: `Player C`

### 手順

| 手順ID | アクション | 期待される動作 | 確認 |
|--------|------------|----------------|------|
| **1-1** | **[A]** ルーム作成 (合言葉: `test`, 名前: `Player A`) | ロビー画面に遷移。`Player A` が表示される。 | [ ] |
| **1-2** | **[B]** ルーム参加 (ID入力, 合言葉: `test`, 名前: `Player B`) | **[A, B]** 両方の画面に `Player B` が表示される。 | [ ] |
| **1-3** | **[C]** ルーム参加 (ID入力, 合言葉: `test`, 名前: `Player C`) | **[A, B, C]** 全員の画面に `Player C` が表示される。 | [ ] |
| **1-4** | **[A]** 設定変更 (時間: 3分, カテゴリ: 食べ物) | **[B, C]** 設定変更がリアルタイムに反映される。 | [ ] |
| **1-5** | **[A]** ゲーム開始 | **[全員]** 「役職配布」画面へ遷移する。 | [ ] |
| **1-6** | **[全員]** 役職確認ボタン押下 | **[全員]** 確認済み人数がリアルタイムに更新される (1/3 -> 2/3 -> 3/3)。<br>全員確認後、「お題確認」画面へ遷移する。 | [ ] |
| **1-7** | **[全員]** お題確認 | **[マスター/インサイダー]** お題が表示される。<br>**[庶民]** 「お題は秘密です」と表示される。<br>全員確認後、「質問フェーズ」へ遷移する。 | [ ] |
| **1-8** | **[全員]** 質問フェーズ進行 | タイマーがカウントダウンする（ズレが許容範囲内か確認）。 | [ ] |
| **1-9** | **[A(マスター)]** 正解報告ボタン押下 | **[全員]** 「討論フェーズ」へ遷移する。 | [ ] |
| **1-10** | **[全員]** 討論フェーズ待機 | タイマー終了後、自動的に「第一投票」画面へ遷移する。 | [ ] |
| **1-11** | **[A]** 投票 (Yes/No) | **[B, C]** 投票済み人数が更新される (1/3)。 | [ ] |
| **1-12** | **[B, C]** 投票 (Yes/No) | **[全員]** 全員投票完了後、自動的に「第二投票」画面へ遷移する。<br>★**ここが不安定な可能性あり** | [ ] |
| **1-13** | **[全員]** 犯人投票 | 全員投票完了後、自動的に「結果発表」画面へ遷移する。 | [ ] |
| **1-14** | **[全員]** 結果確認 | 勝敗、役職、お題が正しく表示される。<br>「もう一度遊ぶ」ボタンが表示される。 | [ ] |

---

## 📝 シナリオ 2: エッジケース検証

異常系や特殊な状況での動作確認。

### 2-1. 途中退出と再接続
| 手順ID | アクション | 期待される動作 | 確認 |
|--------|------------|----------------|------|
| **2-1-1** | ゲーム中に **[B]** がタブを閉じる | **[A, C]** プレイヤーリスト等で切断状態（グレーアウト等）になるか？（未実装なら変化なしか確認） | [ ] |
| **2-1-2** | **[B]** が再度同じURLにアクセス | セッションが維持され、ゲームに復帰できるか？ | [ ] |

### 2-2. タイムアウト遷移
| 手順ID | アクション | 期待される動作 | 確認 |
|--------|------------|----------------|------|
| **2-2-1** | 質問フェーズで時間切れまで放置 | 自動的に「結果発表（時間切れ敗北）」へ遷移するか？ | [ ] |

### 2-3. 同票時の挙動（決選投票）
| 手順ID | アクション | 期待される動作 | 確認 |
|--------|------------|----------------|------|
| **2-3-1** | 第二投票で票を割る (A->B, B->C, C->A) | 決選投票（Runoff）画面へ遷移するか？ | [ ] |

---

## 📝 発見された不具合・課題

| ID | 発生フェーズ | 内容 | 再現性 | 備考 |
|----|--------------|------|--------|------|
| #1 | | | | |
| #2 | | | | |
| #3 | | | | |
